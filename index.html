<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Palette Preview</title>
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --color-bg: #f5f3f0;
    --color-surface: #ffffff;
    --color-text: #1c1917;
    --color-text-muted: #78716c;
    --color-primary: #6366f1;
    --color-secondary: #818cf8;
    --color-border: #e7e5e4;
    --radius: 8px;
    --shadow: 0 1px 3px rgba(0,0,0,0.08);
  }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    background: var(--color-bg);
    color: var(--color-text);
    line-height: 1.6;
    transition: background 0.3s, color 0.3s;
  }

  /* â”€â”€ Controls â”€â”€ */
  .controls {
    position: sticky; top: 0; z-index: 100;
    background: var(--color-surface);
    border-bottom: 1px solid var(--color-border);
    padding: 12px 20px;
    display: flex; align-items: center; gap: 10px; flex-wrap: wrap;
    box-shadow: var(--shadow);
  }
  .controls h1 { font-size: 1.1rem; font-weight: 700; margin-right: auto; }

  .btn {
    padding: 8px 16px; border: none; border-radius: var(--radius);
    font-size: 0.85rem; font-weight: 600; cursor: pointer;
    transition: opacity 0.2s, transform 0.1s;
  }
  .btn:hover { opacity: 0.88; }
  .btn:active { transform: scale(0.97); }
  .btn-primary { background: var(--color-primary); color: #fff; }
  .btn-secondary { background: var(--color-secondary); color: #fff; }
  .btn-outline {
    background: transparent; border: 2px solid var(--color-primary);
    color: var(--color-primary);
  }
  .mode-toggle {
    background: var(--color-text); color: var(--color-bg);
    padding: 8px 12px; border: none; border-radius: var(--radius);
    font-size: 0.85rem; cursor: pointer;
  }

  /* Hue picker */
  .hue-control {
    display: flex; align-items: center; gap: 8px;
  }
  .hue-control label { font-size: 0.8rem; font-weight: 600; }
  .hue-slider {
    -webkit-appearance: none; appearance: none;
    width: 120px; height: 8px; border-radius: 4px;
    background: linear-gradient(to right,
      oklch(0.7 0.15 0), oklch(0.7 0.15 60), oklch(0.7 0.15 120),
      oklch(0.7 0.15 180), oklch(0.7 0.15 240), oklch(0.7 0.15 300), oklch(0.7 0.15 360));
    outline: none;
  }
  .hue-slider::-webkit-slider-thumb {
    -webkit-appearance: none; appearance: none;
    width: 16px; height: 16px; border-radius: 50%;
    background: #fff; border: 2px solid #333; cursor: pointer;
  }
  .hue-value { font-size: 0.8rem; font-family: monospace; min-width: 32px; }

  .scheme-select {
    padding: 6px 10px; border: 2px solid var(--color-border);
    border-radius: var(--radius); font-size: 0.8rem;
    background: var(--color-surface); color: var(--color-text);
  }

  /* â”€â”€ Swatches â”€â”€ */
  .swatches {
    display: flex; flex-wrap: wrap; gap: 6px;
    padding: 14px 20px;
    background: var(--color-surface);
  }
  .swatch {
    flex: 1; min-width: 80px;
    border-radius: var(--radius);
    overflow: hidden;
    box-shadow: var(--shadow);
    border: 1px solid var(--color-border);
  }
  .swatch-color {
    height: 56px;
    display: flex; align-items: center; justify-content: center;
    font-size: 0.7rem; font-weight: 600;
  }
  .swatch-info {
    padding: 5px 7px;
    background: var(--color-surface);
    font-size: 0.7rem;
  }
  .swatch-role { font-weight: 700; text-transform: uppercase; letter-spacing: 0.4px; display: block; }
  .swatch-hex { font-family: monospace; color: var(--color-text-muted); }
  .swatch-oklch { font-family: monospace; color: var(--color-text-muted); font-size: 0.65rem; display: block; }

  /* â”€â”€ WCAG â”€â”€ */
  .wcag-bar {
    padding: 8px 20px;
    background: var(--color-surface);
    border-top: 1px solid var(--color-border);
    font-size: 0.78rem;
    display: flex; gap: 14px; flex-wrap: wrap; align-items: center;
  }
  .wcag-item { display: flex; align-items: center; gap: 4px; }
  .wcag-badge {
    padding: 2px 6px; border-radius: 4px; font-weight: 700; font-size: 0.68rem; color: #fff;
  }
  .wcag-pass { background: #16a34a; }
  .wcag-fail { background: #dc2626; }

  /* â”€â”€ CSS Output â”€â”€ */
  .css-output {
    padding: 10px 20px;
    background: var(--color-surface);
    border-top: 1px solid var(--color-border);
  }
  .css-output pre {
    background: var(--color-bg);
    padding: 12px; border-radius: var(--radius);
    font-size: 0.78rem; overflow-x: auto;
    font-family: 'SF Mono', 'Fira Code', monospace;
    white-space: pre-wrap;
    border: 1px solid var(--color-border);
  }

  /* â”€â”€ Preview â”€â”€ */
  .preview {
    max-width: 800px; margin: 20px auto; padding: 0 20px;
    display: flex; flex-direction: column; gap: 14px;
  }

  .preview-nav {
    background: var(--color-primary);
    color: #fff;
    padding: 12px 20px;
    border-radius: var(--radius);
    display: flex; justify-content: space-between; align-items: center;
    font-weight: 600;
  }
  .preview-nav-links { display: flex; gap: 16px; font-size: 0.85rem; opacity: 0.85; }

  .preview-hero {
    background: var(--color-surface);
    padding: 36px 24px; text-align: center;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    border: 1px solid var(--color-border);
  }
  .preview-hero h2 { font-size: 1.4rem; margin-bottom: 6px; }
  .preview-hero p { color: var(--color-text-muted); margin-bottom: 14px; }

  .preview-cards {
    display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 12px;
  }
  .preview-card {
    background: var(--color-surface);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    overflow: hidden;
    border: 1px solid var(--color-border);
  }
  .preview-card-header { height: 6px; }
  .preview-card-body { padding: 14px; }
  .preview-card-body h3 { font-size: 0.95rem; margin-bottom: 4px; }
  .preview-card-body p { font-size: 0.82rem; color: var(--color-text-muted); margin-bottom: 10px; }

  .preview-form {
    background: var(--color-surface);
    padding: 18px; border-radius: var(--radius);
    box-shadow: var(--shadow);
    display: flex; flex-direction: column; gap: 10px;
    border: 1px solid var(--color-border);
  }
  .preview-form label { font-size: 0.82rem; font-weight: 600; }
  .preview-form input, .preview-form textarea {
    padding: 8px 12px; border: 2px solid var(--color-border);
    border-radius: var(--radius); font-size: 0.85rem;
    background: var(--color-bg); color: var(--color-text);
  }
  .preview-form input:focus, .preview-form textarea:focus {
    outline: none; border-color: var(--color-primary);
  }
  .preview-form textarea { resize: vertical; min-height: 56px; }
  .form-row { display: flex; gap: 8px; }

  .preview-tags { display: flex; gap: 6px; flex-wrap: wrap; }
  .tag {
    padding: 3px 10px; border-radius: 999px; font-size: 0.72rem; font-weight: 600;
  }

  .preview-footer {
    text-align: center; padding: 14px;
    font-size: 0.78rem; color: var(--color-text-muted);
  }

  @media (max-width: 600px) {
    .controls { padding: 10px 12px; gap: 6px; }
    .hue-slider { width: 80px; }
    .swatches { padding: 10px 12px; }
    .preview { padding: 0 12px; }
    .swatch { min-width: 55px; }
  }
</style>
</head>
<body>

<div class="controls">
  <h1>ğŸ¨ Palette Preview</h1>
  <div class="hue-control">
    <label>Hue</label>
    <input type="range" class="hue-slider" id="hueSlider" min="0" max="360" value="260">
    <span class="hue-value" id="hueValue">260Â°</span>
  </div>
  <select class="scheme-select" id="schemeSelect">
    <option value="mono">Monochromatic</option>
    <option value="analogous">Analogous (Â±30Â°)</option>
    <option value="complementary">Complementary</option>
    <option value="split">Split Complementary</option>
  </select>
  <button class="btn btn-primary" onclick="randomize()">ğŸ² Random</button>
  <button class="btn btn-outline" onclick="copyCSS()">Copy CSS</button>
  <button class="mode-toggle" onclick="toggleMode()" id="modeBtn">ğŸŒ™ Dark</button>
</div>

<div class="swatches" id="swatches"></div>
<div class="wcag-bar" id="wcag"></div>
<div class="css-output"><pre id="cssOutput"></pre></div>

<div class="preview">
  <nav class="preview-nav">
    <span>MyApp</span>
    <div class="preview-nav-links"><span>Home</span><span>About</span><span>Contact</span></div>
  </nav>

  <div class="preview-hero">
    <h2>Welcome to the App</h2>
    <p>This is a preview of your color palette applied to a real UI layout.</p>
    <button class="btn btn-primary" style="margin-right:8px">Get Started</button>
    <button class="btn btn-secondary">Learn More</button>
  </div>

  <div class="preview-cards">
    <div class="preview-card">
      <div class="preview-card-header" style="background:var(--color-primary)"></div>
      <div class="preview-card-body">
        <h3>Feature One</h3>
        <p>A short description of this feature and why it matters to users.</p>
        <div class="preview-tags">
          <span class="tag" style="background:var(--color-primary);color:#fff">New</span>
          <span class="tag" style="background:var(--color-secondary);color:#fff">Beta</span>
        </div>
      </div>
    </div>
    <div class="preview-card">
      <div class="preview-card-header" style="background:var(--color-secondary)"></div>
      <div class="preview-card-body">
        <h3>Feature Two</h3>
        <p>Another important feature that users will love to explore daily.</p>
        <button class="btn btn-outline" style="font-size:0.78rem;padding:4px 12px">Details â†’</button>
      </div>
    </div>
    <div class="preview-card">
      <div class="preview-card-header" style="background:var(--color-text-muted);opacity:0.3"></div>
      <div class="preview-card-body">
        <h3>Feature Three</h3>
        <p>Great things come in threes. This one is no exception at all.</p>
        <button class="btn btn-secondary" style="font-size:0.78rem;padding:4px 12px">Try It</button>
      </div>
    </div>
  </div>

  <div class="preview-form">
    <label>Contact Us</label>
    <input type="text" placeholder="Your name">
    <input type="email" placeholder="Email address">
    <textarea placeholder="Your message..."></textarea>
    <div class="form-row">
      <button class="btn btn-primary" style="flex:1">Send</button>
      <button class="btn btn-outline" style="flex:1">Cancel</button>
    </div>
  </div>

  <div class="preview-footer">Built with ğŸ¨ Palette Preview â€” OKLCH-based palette derivation</div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// OKLCH â†” sRGB conversion utilities
// Using simplified but accurate conversion chain:
// OKLCH â†’ OKLab â†’ linear-sRGB â†’ sRGB
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function oklchToOklab(L, C, H) {
  const hRad = H * Math.PI / 180;
  return [L, C * Math.cos(hRad), C * Math.sin(hRad)];
}

function oklabToLinearRGB(L, a, b) {
  // OKLab â†’ LMS
  const l_ = L + 0.3963377774 * a + 0.2158037573 * b;
  const m_ = L - 0.1055613458 * a - 0.0638541728 * b;
  const s_ = L - 0.0894841775 * a - 1.2914855480 * b;

  const l = l_ * l_ * l_;
  const m = m_ * m_ * m_;
  const s = s_ * s_ * s_;

  // LMS â†’ linear sRGB
  return [
    +4.0767416621 * l - 3.3077115913 * m + 0.2309699292 * s,
    -1.2684380046 * l + 2.6097574011 * m - 0.3413193965 * s,
    -0.0041960863 * l - 0.7034186147 * m + 1.7076147010 * s,
  ];
}

function linearToSrgb(c) {
  return c <= 0.0031308 ? 12.92 * c : 1.055 * Math.pow(c, 1 / 2.4) - 0.055;
}

function srgbToLinear(c) {
  return c <= 0.04045 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4);
}

function oklchToRGB(L, C, H) {
  const [labL, labA, labB] = oklchToOklab(L, C, H);
  const [lr, lg, lb] = oklabToLinearRGB(labL, labA, labB);
  return [
    Math.round(Math.min(1, Math.max(0, linearToSrgb(lr))) * 255),
    Math.round(Math.min(1, Math.max(0, linearToSrgb(lg))) * 255),
    Math.round(Math.min(1, Math.max(0, linearToSrgb(lb))) * 255),
  ];
}

function rgbToHex(r, g, b) {
  return '#' + [r, g, b].map(c => c.toString(16).padStart(2, '0')).join('');
}

// Relative luminance for WCAG contrast
function luminance(r, g, b) {
  const [rs, gs, bs] = [r, g, b].map(c => srgbToLinear(c / 255));
  return 0.2126 * rs + 0.7152 * gs + 0.0722 * bs;
}

function contrastRatio(rgb1, rgb2) {
  const l1 = luminance(...rgb1);
  const l2 = luminance(...rgb2);
  return (Math.max(l1, l2) + 0.05) / (Math.min(l1, l2) + 0.05);
}

// Check if OKLCH color is within sRGB gamut
function inGamut(L, C, H) {
  const [labL, labA, labB] = oklchToOklab(L, C, H);
  const [lr, lg, lb] = oklabToLinearRGB(labL, labA, labB);
  const eps = 0.001;
  return lr >= -eps && lr <= 1 + eps && lg >= -eps && lg <= 1 + eps && lb >= -eps && lb <= 1 + eps;
}

// Clamp chroma to gamut
function clampChroma(L, C, H) {
  if (inGamut(L, C, H)) return C;
  let lo = 0, hi = C;
  for (let i = 0; i < 20; i++) {
    const mid = (lo + hi) / 2;
    if (inGamut(L, mid, H)) lo = mid; else hi = mid;
  }
  return lo;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Palette Generation â€” derive all colors from one hue
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let darkMode = false;
let currentPalette = null; // { bg, surface, text, textMuted, primary, secondary, border } each = {oklch, rgb, hex}

function makeColor(L, C, H) {
  C = clampChroma(L, C, H);
  const rgb = oklchToRGB(L, C, H);
  return {
    oklch: [L, C, H],
    rgb,
    hex: rgbToHex(...rgb),
  };
}

function generatePalette(hue, scheme) {
  const H = hue;

  // Determine secondary hue based on scheme
  let H2;
  switch (scheme) {
    case 'analogous':      H2 = (H + 30) % 360; break;
    case 'complementary':  H2 = (H + 180) % 360; break;
    case 'split':          H2 = (H + 150) % 360; break;
    default:               H2 = H; break; // mono: same hue, different chroma
  }

  if (darkMode) {
    // Dark mode: dark bg with hint of hue, light text
    return {
      bg:        makeColor(0.18, 0.01, H),       // very dark, barely tinted
      surface:   makeColor(0.23, 0.015, H),      // slightly lighter surface
      text:      makeColor(0.93, 0.01, H),        // near white, hue-tinted
      textMuted: makeColor(0.65, 0.02, H),        // muted text
      primary:   makeColor(0.70, 0.16, H),        // vibrant but not blinding
      secondary: makeColor(0.65, scheme === 'mono' ? 0.10 : 0.14, H2),
      border:    makeColor(0.32, 0.02, H),        // subtle border
    };
  } else {
    // Light mode: light bg with hint of hue, dark text
    return {
      bg:        makeColor(0.95, 0.008, H),       // near white, barely tinted
      surface:   makeColor(0.99, 0.003, H),       // almost pure white
      text:      makeColor(0.20, 0.015, H),        // near black, hue-tinted
      textMuted: makeColor(0.50, 0.03, H),         // muted text
      primary:   makeColor(0.55, 0.19, H),         // rich accent
      secondary: makeColor(0.60, scheme === 'mono' ? 0.12 : 0.16, H2),
      border:    makeColor(0.88, 0.01, H),         // subtle border
    };
  }
}

function applyPalette(palette) {
  currentPalette = palette;
  const root = document.documentElement;

  const mapping = {
    'bg': '--color-bg',
    'surface': '--color-surface',
    'text': '--color-text',
    'textMuted': '--color-text-muted',
    'primary': '--color-primary',
    'secondary': '--color-secondary',
    'border': '--color-border',
  };

  for (const [key, cssVar] of Object.entries(mapping)) {
    root.style.setProperty(cssVar, palette[key].hex);
  }

  updateSwatches(palette);
  updateWCAG(palette);
  updateCSSOutput(palette);
}

const ROLE_ORDER = ['bg', 'surface', 'border', 'textMuted', 'text', 'primary', 'secondary'];
const ROLE_LABELS = {
  bg: 'Background', surface: 'Surface', text: 'Text',
  textMuted: 'Muted', primary: 'Primary', secondary: 'Secondary',
  border: 'Border',
};

function updateSwatches(palette) {
  const container = document.getElementById('swatches');
  container.innerHTML = '';
  for (const role of ROLE_ORDER) {
    const c = palette[role];
    const textOnSwatch = luminance(...c.rgb) > 0.4 ? '#000' : '#fff';
    const [L, C, H] = c.oklch;
    container.innerHTML += `
      <div class="swatch">
        <div class="swatch-color" style="background:${c.hex};color:${textOnSwatch}">
          ${c.hex.toUpperCase()}
        </div>
        <div class="swatch-info">
          <span class="swatch-role">${ROLE_LABELS[role]}</span>
          <span class="swatch-hex">${c.hex}</span>
          <span class="swatch-oklch">L${L.toFixed(2)} C${C.toFixed(3)} H${Math.round(H)}</span>
        </div>
      </div>`;
  }
}

function updateWCAG(palette) {
  const container = document.getElementById('wcag');
  const pairs = [
    ['text', 'bg', 'Text/BG'],
    ['text', 'surface', 'Text/Surface'],
    ['textMuted', 'bg', 'Muted/BG'],
    ['textMuted', 'surface', 'Muted/Surface'],
    ['primary', 'bg', 'Primary/BG'],
    ['primary', 'surface', 'Primary/Surface'],
  ];
  container.innerHTML = '<strong style="font-size:0.75rem">WCAG AA (4.5:1):</strong> ' + pairs.map(([fg, bg, label]) => {
    const ratio = contrastRatio(palette[fg].rgb, palette[bg].rgb);
    const pass = ratio >= 4.5;
    return `<span class="wcag-item">
      <span class="wcag-badge ${pass ? 'wcag-pass' : 'wcag-fail'}">${ratio.toFixed(1)}</span>
      <span>${label}</span>
    </span>`;
  }).join('');
}

function updateCSSOutput(palette) {
  const vars = [
    ['--color-bg', 'bg'],
    ['--color-surface', 'surface'],
    ['--color-text', 'text'],
    ['--color-text-muted', 'textMuted'],
    ['--color-primary', 'primary'],
    ['--color-secondary', 'secondary'],
    ['--color-border', 'border'],
  ];
  const lines = vars.map(([name, key]) => {
    const c = palette[key];
    const [L, C, H] = c.oklch;
    return `  ${name}: ${c.hex};  /* oklch(${L.toFixed(2)} ${C.toFixed(3)} ${Math.round(H)}) */`;
  });
  document.getElementById('cssOutput').textContent = `:root {\n${lines.join('\n')}\n}`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UI Handlers
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function update() {
  const hue = parseInt(document.getElementById('hueSlider').value);
  const scheme = document.getElementById('schemeSelect').value;
  document.getElementById('hueValue').textContent = hue + 'Â°';
  applyPalette(generatePalette(hue, scheme));
}

function randomize() {
  const hue = Math.floor(Math.random() * 360);
  document.getElementById('hueSlider').value = hue;
  update();
}

function toggleMode() {
  darkMode = !darkMode;
  document.getElementById('modeBtn').textContent = darkMode ? 'â˜€ï¸ Light' : 'ğŸŒ™ Dark';
  update();
}

function copyCSS() {
  const text = document.getElementById('cssOutput').textContent;
  navigator.clipboard.writeText(text).then(() => {
    const btn = document.querySelector('.btn-outline');
    const orig = btn.textContent;
    btn.textContent = 'âœ“ Copied!';
    setTimeout(() => btn.textContent = orig, 1500);
  });
}

// Event listeners
document.getElementById('hueSlider').addEventListener('input', update);
document.getElementById('schemeSelect').addEventListener('change', update);

// Init
update();
</script>
</body>
</html>
