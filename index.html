<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Palette Preview</title>
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --color-bg: #f5f5f5;
    --color-surface: #ffffff;
    --color-text: #1a1a1a;
    --color-text-muted: #737373;
    --color-primary: #6366f1;
    --color-secondary: #a5b4fc;
    --color-border: #e5e5e5;
    --radius: 8px;
    --shadow: 0 1px 3px rgba(0,0,0,0.08);
  }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    background: var(--color-bg);
    color: var(--color-text);
    line-height: 1.6;
    transition: background 0.3s, color 0.3s;
  }

  .loading-overlay {
    position: fixed; inset: 0; z-index: 9999;
    background: #f5f5f5;
    display: flex; align-items: center; justify-content: center;
    font-size: 1.1rem; color: #666;
    transition: opacity 0.3s;
  }
  .loading-overlay.hidden { opacity: 0; pointer-events: none; }

  /* â”€â”€ Controls â”€â”€ */
  .controls {
    position: sticky; top: 0; z-index: 100;
    background: var(--color-surface);
    border-bottom: 1px solid var(--color-border);
    padding: 12px 20px;
    display: flex; align-items: center; gap: 10px; flex-wrap: wrap;
    box-shadow: var(--shadow);
  }
  .controls h1 { font-size: 1.05rem; font-weight: 700; margin-right: auto; }

  .btn {
    padding: 8px 16px; border: none; border-radius: var(--radius);
    font-size: 0.83rem; font-weight: 600; cursor: pointer;
    transition: opacity 0.2s, transform 0.1s;
  }
  .btn:hover { opacity: 0.88; }
  .btn:active { transform: scale(0.97); }
  .btn-primary { background: var(--color-primary); color: #fff; }
  .btn-secondary { background: var(--color-secondary); color: var(--color-text); }
  .btn-outline {
    background: transparent; border: 2px solid var(--color-primary);
    color: var(--color-primary);
  }
  .mode-toggle {
    background: var(--color-text); color: var(--color-bg);
    padding: 8px 12px; border: none; border-radius: var(--radius);
    font-size: 0.83rem; cursor: pointer;
  }

  /* Color input */
  .color-input-group {
    display: flex; align-items: center; gap: 6px;
  }
  .color-input-group label { font-size: 0.8rem; font-weight: 600; }
  .color-swatch-input {
    width: 32px; height: 32px; border: 2px solid var(--color-border);
    border-radius: 6px; cursor: pointer; padding: 0;
    -webkit-appearance: none; appearance: none;
  }
  .color-swatch-input::-webkit-color-swatch-wrapper { padding: 0; }
  .color-swatch-input::-webkit-color-swatch { border: none; border-radius: 4px; }
  .color-hex-input {
    width: 80px; padding: 5px 8px; border: 2px solid var(--color-border);
    border-radius: var(--radius); font-size: 0.8rem; font-family: monospace;
    background: var(--color-surface); color: var(--color-text);
  }

  .scheme-select {
    padding: 6px 10px; border: 2px solid var(--color-border);
    border-radius: var(--radius); font-size: 0.8rem;
    background: var(--color-surface); color: var(--color-text);
  }

  /* â”€â”€ Swatches â”€â”€ */
  .swatches {
    display: flex; flex-wrap: wrap; gap: 4px;
    padding: 12px 20px;
    background: var(--color-surface);
  }
  .swatch {
    flex: 1; min-width: 70px;
    border-radius: var(--radius);
    overflow: hidden;
    box-shadow: var(--shadow);
    border: 1px solid var(--color-border);
  }
  .swatch-color {
    height: 52px;
    display: flex; align-items: center; justify-content: center;
    font-size: 0.68rem; font-weight: 600;
  }
  .swatch-info {
    padding: 4px 6px;
    background: var(--color-surface);
    font-size: 0.68rem;
  }
  .swatch-role { font-weight: 700; text-transform: uppercase; letter-spacing: 0.4px; display: block; }
  .swatch-hex { font-family: monospace; color: var(--color-text-muted); }
  .swatch-shade { font-family: monospace; color: var(--color-text-muted); font-size: 0.62rem; }

  /* â”€â”€ Full scale â”€â”€ */
  .scale-row {
    display: flex; gap: 2px; padding: 4px 20px;
    background: var(--color-surface);
  }
  .scale-row .scale-label {
    font-size: 0.7rem; font-weight: 600; min-width: 52px;
    display: flex; align-items: center;
  }
  .scale-chip {
    flex: 1; height: 28px; border-radius: 4px;
    display: flex; align-items: center; justify-content: center;
    font-size: 0.58rem; font-weight: 600;
    cursor: default;
    position: relative;
  }
  .scale-chip.active { outline: 2px solid var(--color-text); outline-offset: 1px; }
  .scale-chip span { opacity: 0.8; }

  /* â”€â”€ WCAG â”€â”€ */
  .wcag-bar {
    padding: 8px 20px;
    background: var(--color-surface);
    border-top: 1px solid var(--color-border);
    font-size: 0.76rem;
    display: flex; gap: 12px; flex-wrap: wrap; align-items: center;
  }
  .wcag-badge {
    padding: 2px 6px; border-radius: 4px; font-weight: 700; font-size: 0.66rem; color: #fff;
  }
  .wcag-pass { background: #16a34a; }
  .wcag-fail { background: #dc2626; }

  /* â”€â”€ CSS Output â”€â”€ */
  .css-output {
    padding: 10px 20px;
    background: var(--color-surface);
    border-top: 1px solid var(--color-border);
  }
  .css-output pre {
    background: var(--color-bg);
    padding: 12px; border-radius: var(--radius);
    font-size: 0.76rem; overflow-x: auto;
    font-family: 'SF Mono', 'Fira Code', monospace;
    white-space: pre-wrap;
    border: 1px solid var(--color-border);
  }

  /* â”€â”€ Preview â”€â”€ */
  .preview {
    max-width: 800px; margin: 20px auto; padding: 0 20px;
    display: flex; flex-direction: column; gap: 14px;
  }

  .preview-nav {
    background: var(--color-primary);
    color: #fff;
    padding: 12px 20px;
    border-radius: var(--radius);
    display: flex; justify-content: space-between; align-items: center;
    font-weight: 600;
  }
  .preview-nav-links { display: flex; gap: 16px; font-size: 0.83rem; opacity: 0.85; }

  .preview-hero {
    background: var(--color-surface);
    padding: 32px 24px; text-align: center;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    border: 1px solid var(--color-border);
  }
  .preview-hero h2 { font-size: 1.3rem; margin-bottom: 6px; }
  .preview-hero p { color: var(--color-text-muted); margin-bottom: 14px; }

  .preview-cards {
    display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 12px;
  }
  .preview-card {
    background: var(--color-surface);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    overflow: hidden;
    border: 1px solid var(--color-border);
  }
  .preview-card-header { height: 6px; }
  .preview-card-body { padding: 14px; }
  .preview-card-body h3 { font-size: 0.92rem; margin-bottom: 4px; }
  .preview-card-body p { font-size: 0.8rem; color: var(--color-text-muted); margin-bottom: 10px; }

  .preview-form {
    background: var(--color-surface);
    padding: 18px; border-radius: var(--radius);
    box-shadow: var(--shadow);
    display: flex; flex-direction: column; gap: 10px;
    border: 1px solid var(--color-border);
  }
  .preview-form label { font-size: 0.8rem; font-weight: 600; }
  .preview-form input[type="text"], .preview-form input[type="email"], .preview-form textarea {
    padding: 8px 12px; border: 2px solid var(--color-border);
    border-radius: var(--radius); font-size: 0.83rem;
    background: var(--color-bg); color: var(--color-text);
  }
  .preview-form input:focus, .preview-form textarea:focus {
    outline: none; border-color: var(--color-primary);
  }
  .preview-form textarea { resize: vertical; min-height: 52px; }
  .form-row { display: flex; gap: 8px; }

  .preview-tags { display: flex; gap: 6px; flex-wrap: wrap; }
  .tag { padding: 3px 10px; border-radius: 999px; font-size: 0.7rem; font-weight: 600; }

  .preview-footer {
    text-align: center; padding: 14px;
    font-size: 0.76rem; color: var(--color-text-muted);
  }

  @media (max-width: 600px) {
    .controls { padding: 10px 12px; gap: 6px; }
    .swatches { padding: 8px 12px; }
    .scale-row { padding: 4px 12px; }
    .preview { padding: 0 12px; }
    .swatch { min-width: 50px; }
  }
</style>
</head>
<body>

<div class="loading-overlay" id="loading">ðŸŽ¨ Loading color engine...</div>

<div class="controls">
  <h1>ðŸŽ¨ Palette Preview</h1>
  <div class="color-input-group">
    <label>Primary</label>
    <input type="color" class="color-swatch-input" id="colorPicker" value="#6366f1">
    <input type="text" class="color-hex-input" id="hexInput" value="#6366f1" maxlength="7">
  </div>
  <select class="scheme-select" id="schemeSelect">
    <option value="single">Single Hue</option>
    <option value="analogous">+ Analogous accent</option>
    <option value="complementary">+ Complementary accent</option>
  </select>
  <button class="btn btn-primary" onclick="randomize()">ðŸŽ² Random</button>
  <button class="btn btn-outline" onclick="copyCSS()">Copy CSS</button>
  <button class="mode-toggle" onclick="toggleMode()" id="modeBtn">ðŸŒ™ Dark</button>
</div>

<div class="swatches" id="swatches"></div>
<div class="scale-row" id="colorScale"></div>
<div class="scale-row" id="neutralScale"></div>
<div class="wcag-bar" id="wcag"></div>
<div class="css-output"><pre id="cssOutput"></pre></div>

<div class="preview">
  <nav class="preview-nav">
    <span>MyApp</span>
    <div class="preview-nav-links"><span>Home</span><span>About</span><span>Contact</span></div>
  </nav>

  <div class="preview-hero">
    <h2>Welcome to the App</h2>
    <p>This is a preview of your color palette applied to a real UI layout.</p>
    <button class="btn btn-primary" style="margin-right:8px">Get Started</button>
    <button class="btn btn-secondary">Learn More</button>
  </div>

  <div class="preview-cards">
    <div class="preview-card">
      <div class="preview-card-header" style="background:var(--color-primary)"></div>
      <div class="preview-card-body">
        <h3>Feature One</h3>
        <p>A short description of this feature and why it matters to users.</p>
        <div class="preview-tags">
          <span class="tag" style="background:var(--color-primary);color:#fff">New</span>
          <span class="tag" style="background:var(--color-secondary);color:var(--color-text)">Beta</span>
        </div>
      </div>
    </div>
    <div class="preview-card">
      <div class="preview-card-header" style="background:var(--color-secondary)"></div>
      <div class="preview-card-body">
        <h3>Feature Two</h3>
        <p>Another important feature that users will love to explore daily.</p>
        <button class="btn btn-outline" style="font-size:0.76rem;padding:4px 12px">Details â†’</button>
      </div>
    </div>
    <div class="preview-card">
      <div class="preview-card-header" style="background:var(--color-text-muted);opacity:0.3"></div>
      <div class="preview-card-body">
        <h3>Feature Three</h3>
        <p>Great things come in threes. This one is no exception at all.</p>
        <button class="btn btn-secondary" style="font-size:0.76rem;padding:4px 12px">Try It</button>
      </div>
    </div>
  </div>

  <div class="preview-form">
    <label>Contact Us</label>
    <input type="text" placeholder="Your name">
    <input type="email" placeholder="Email address">
    <textarea placeholder="Your message..."></textarea>
    <div class="form-row">
      <button class="btn btn-primary" style="flex:1">Send</button>
      <button class="btn btn-outline" style="flex:1">Cancel</button>
    </div>
  </div>

  <div class="preview-footer">
    Built with ðŸŽ¨ Palette Preview â€” Powered by
    <a href="https://github.com/meodai/dittoTones" target="_blank" style="color:var(--color-primary)">dittoTones</a>
    (Tailwind v4 color DNA)
  </div>
</div>

<script type="module">
import { DittoTones } from 'https://esm.sh/dittotones@0.10.0';
import { tailwindRamps } from 'https://esm.sh/dittotones@0.10.0/ramps/tailwind';
import { formatHex, oklch, parse } from 'https://esm.sh/culori@4';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Init dittoTones with Tailwind's color DNA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const ditto = new DittoTones({ ramps: tailwindRamps });

let darkMode = false;

// Role mapping: which Tailwind shade â†’ which UI role
// Color scale = the accent color ramp
// Neutral scale = same hue but desaturated (use gray-ish neutral from Tailwind)
const LIGHT_ROLES = {
  bg:        { source: 'neutral', shade: '50' },
  surface:   { source: 'neutral', shade: '100' },
  border:    { source: 'neutral', shade: '200' },
  textMuted: { source: 'neutral', shade: '500' },
  text:      { source: 'neutral', shade: '900' },
  primary:   { source: 'color',   shade: '500' },
  secondary: { source: 'color',   shade: '200' },
};

const DARK_ROLES = {
  bg:        { source: 'neutral', shade: '950' },
  surface:   { source: 'neutral', shade: '900' },
  border:    { source: 'neutral', shade: '800' },
  textMuted: { source: 'neutral', shade: '400' },
  text:      { source: 'neutral', shade: '50' },
  primary:   { source: 'color',   shade: '400' },
  secondary: { source: 'color',   shade: '700' },
};

const ROLE_LABELS = {
  bg: 'Background', surface: 'Surface', text: 'Text',
  textMuted: 'Muted', primary: 'Primary', secondary: 'Secondary',
  border: 'Border',
};
const ROLE_ORDER = ['bg', 'surface', 'border', 'textMuted', 'text', 'primary', 'secondary'];
const SHADE_KEYS = ['50','100','200','300','400','500','600','700','800','900','950'];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Generate scales and derive palette
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function generateNeutralHex(primaryHex) {
  // Neutral = same hue as primary but very low chroma
  const p = oklch(parse(primaryHex));
  if (!p) return null;
  // Create a low-chroma version of the primary for neutral generation
  const neutralColor = formatHex({ mode: 'oklch', l: p.l, c: Math.min(p.c * 0.12, 0.02), h: p.h });
  return neutralColor;
}

function getSecondaryInputHex(primaryHex, scheme) {
  const p = oklch(parse(primaryHex));
  if (!p || scheme === 'single') return null;

  let hueShift = scheme === 'analogous' ? 40 : 180;
  const newHue = ((p.h || 0) + hueShift) % 360;
  const secColor = { mode: 'oklch', l: p.l, c: p.c * 0.85, h: newHue };
  return formatHex(secColor);
}

function scaleToHexMap(scale) {
  const map = {};
  for (const [shade, color] of Object.entries(scale)) {
    map[shade] = formatHex(color);
  }
  return map;
}

function luminance(hex) {
  const r = parseInt(hex.slice(1,3), 16) / 255;
  const g = parseInt(hex.slice(3,5), 16) / 255;
  const b = parseInt(hex.slice(5,7), 16) / 255;
  const toLinear = c => c <= 0.04045 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4);
  return 0.2126 * toLinear(r) + 0.7152 * toLinear(g) + 0.0722 * toLinear(b);
}

function contrastRatio(hex1, hex2) {
  const l1 = luminance(hex1);
  const l2 = luminance(hex2);
  return (Math.max(l1, l2) + 0.05) / (Math.min(l1, l2) + 0.05);
}

function textOnColor(hex) {
  return luminance(hex) > 0.4 ? '#000000' : '#ffffff';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Main update
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function update() {
  const primaryHex = document.getElementById('hexInput').value;
  const scheme = document.getElementById('schemeSelect').value;

  // Generate color scale from primary
  let colorResult;
  try {
    colorResult = ditto.generate(primaryHex);
  } catch (e) {
    console.error('dittoTones error:', e);
    return;
  }
  const colorScale = scaleToHexMap(colorResult.scale);

  // Generate neutral scale (tinted gray from primary hue)
  const neutralHex = generateNeutralHex(primaryHex);
  const neutralResult = ditto.generate(neutralHex || '#737373');
  const neutralScale = scaleToHexMap(neutralResult.scale);

  // If scheme uses secondary accent, generate that too
  let secondaryScale = colorScale; // default: same as primary
  const secHex = getSecondaryInputHex(primaryHex, scheme);
  if (secHex) {
    try {
      const secResult = ditto.generate(secHex);
      secondaryScale = scaleToHexMap(secResult.scale);
    } catch (e) {
      secondaryScale = colorScale;
    }
  }

  // Pick roles
  const roles = darkMode ? DARK_ROLES : LIGHT_ROLES;
  const palette = {};
  for (const [role, def] of Object.entries(roles)) {
    if (def.source === 'neutral') {
      palette[role] = neutralScale[def.shade];
    } else if (role === 'secondary' && scheme !== 'single') {
      palette[role] = secondaryScale[def.shade];
    } else {
      palette[role] = colorScale[def.shade];
    }
  }

  // Apply CSS variables
  const root = document.documentElement;
  const varMap = {
    bg: '--color-bg', surface: '--color-surface', text: '--color-text',
    textMuted: '--color-text-muted', primary: '--color-primary',
    secondary: '--color-secondary', border: '--color-border',
  };
  for (const [role, cssVar] of Object.entries(varMap)) {
    root.style.setProperty(cssVar, palette[role]);
  }

  // Update swatches
  const swatchContainer = document.getElementById('swatches');
  swatchContainer.innerHTML = ROLE_ORDER.map(role => {
    const hex = palette[role];
    const tc = textOnColor(hex);
    const roleDef = roles[role];
    return `<div class="swatch">
      <div class="swatch-color" style="background:${hex};color:${tc}">${hex.toUpperCase()}</div>
      <div class="swatch-info">
        <span class="swatch-role">${ROLE_LABELS[role]}</span>
        <span class="swatch-shade">${roleDef.source}/${roleDef.shade}</span>
      </div>
    </div>`;
  }).join('');

  // Render full scales
  renderScale('colorScale', 'Color', colorScale, roles, 'color');
  renderScale('neutralScale', 'Neutral', neutralScale, roles, 'neutral');

  // WCAG
  const wcagContainer = document.getElementById('wcag');
  const pairs = [
    ['text','bg'], ['text','surface'], ['textMuted','bg'],
    ['textMuted','surface'], ['primary','bg'], ['primary','surface'],
  ];
  wcagContainer.innerHTML = '<strong style="font-size:0.73rem">WCAG AA:</strong> ' +
    pairs.map(([fg, bg]) => {
      const ratio = contrastRatio(palette[fg], palette[bg]);
      const pass = ratio >= 4.5;
      return `<span style="display:flex;align-items:center;gap:3px">
        <span class="wcag-badge ${pass ? 'wcag-pass' : 'wcag-fail'}">${ratio.toFixed(1)}</span>
        <span style="font-size:0.73rem">${ROLE_LABELS[fg]}/${ROLE_LABELS[bg]}</span>
      </span>`;
    }).join('');

  // CSS output
  const cssLines = Object.entries(varMap).map(([role, varName]) =>
    `  ${varName}: ${palette[role]};`
  );
  document.getElementById('cssOutput').textContent = `:root {\n${cssLines.join('\n')}\n}`;
}

function renderScale(containerId, label, scale, roles, sourceType) {
  const container = document.getElementById(containerId);
  // Find which shades are "active" (used in current roles)
  const activeShades = new Set();
  for (const [role, def] of Object.entries(roles)) {
    if (def.source === sourceType) activeShades.add(def.shade);
  }

  container.innerHTML = `<span class="scale-label">${label}</span>` +
    SHADE_KEYS.map(shade => {
      const hex = scale[shade];
      const tc = textOnColor(hex);
      const isActive = activeShades.has(shade);
      return `<div class="scale-chip ${isActive ? 'active' : ''}" style="background:${hex};color:${tc}" title="${shade}: ${hex}">
        <span>${shade}</span>
      </div>`;
    }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UI handlers
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function syncInputs(hex) {
  document.getElementById('colorPicker').value = hex;
  document.getElementById('hexInput').value = hex;
}

document.getElementById('colorPicker').addEventListener('input', e => {
  document.getElementById('hexInput').value = e.target.value;
  update();
});

document.getElementById('hexInput').addEventListener('input', e => {
  let v = e.target.value;
  if (/^#[0-9a-fA-F]{6}$/.test(v)) {
    document.getElementById('colorPicker').value = v;
    update();
  }
});

document.getElementById('schemeSelect').addEventListener('change', update);

window.randomize = () => {
  const hue = Math.floor(Math.random() * 360);
  const hex = formatHex({ mode: 'oklch', l: 0.55, c: 0.2, h: hue });
  syncInputs(hex);
  update();
};

window.toggleMode = () => {
  darkMode = !darkMode;
  document.getElementById('modeBtn').textContent = darkMode ? 'â˜€ï¸ Light' : 'ðŸŒ™ Dark';
  update();
};

window.copyCSS = () => {
  const text = document.getElementById('cssOutput').textContent;
  navigator.clipboard.writeText(text).then(() => {
    const btn = document.querySelector('.btn-outline');
    const orig = btn.textContent;
    btn.textContent = 'âœ“ Copied!';
    setTimeout(() => btn.textContent = orig, 1500);
  });
};

// Init
update();
document.getElementById('loading').classList.add('hidden');
</script>
</body>
</html>
